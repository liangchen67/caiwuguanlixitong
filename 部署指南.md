# Windows 服务器部署指南

## 📋 环境准备

### 必需软件
- JDK 1.8+
- MySQL 8.0
- Nginx for Windows

### 安装步骤

1. **安装 JDK**
   - 下载并安装 JDK 1.8
   - 配置 JAVA_HOME 环境变量
   - 验证：`java -version`

2. **安装 MySQL**
   - 下载并安装 MySQL 8.0
   - 启动服务：`net start MySQL80`
   - 验证：`mysql --version`

3. **安装 Nginx**
   - 下载 Nginx for Windows
   - 解压到：`C:\nginx`

## 🗄️ 数据库部署

```sql
-- 创建数据库
CREATE DATABASE finance_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- 导入初始化脚本
mysql -u root -p finance_db < database/init.sql
```

## 🖥️ 后端部署

### 1. 打包应用

```bash
cd backend
mvn clean package
```

### 2. 配置文件

修改 `application.yml`：

```yaml
spring:
  datasource:
    password: 生产环境密码
  jpa:
    hibernate:
      ddl-auto: none  # 生产环境使用 none
    show-sql: false   # 关闭 SQL 日志
```

### 3. 启动服务

**方式一：直接运行**
```bash
java -jar target/finance-management-1.0.0.jar
```

**方式二：注册为 Windows 服务**
使用 WinSW 工具注册为系统服务，实现开机自启。

## 🌐 前端部署

### 1. 构建生产版本

```bash
cd frontend
npm install
npm run build
```

### 2. 部署到 Nginx

```bash
# 复制构建文件
xcopy dist C:\nginx\html\finance\ /E /I /Y
```

### 3. 配置 Nginx

编辑 `C:\nginx\conf\nginx.conf`：

```nginx
http {
    upstream backend {
        server 127.0.0.1:8080;
    }

    server {
        listen       80;
        server_name  your-domain.com;
        
        location / {
            root   html/finance;
            index  index.html;
            try_files $uri $uri/ /index.html;
        }
        
        location /api/ {
            proxy_pass http://backend;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }
    }
}
```

### 4. 启动 Nginx

```bash
cd C:\nginx
start nginx
```

## 🔥 防火墙配置

```powershell
# 开放 80 端口
netsh advfirewall firewall add rule name="HTTP Port 80" dir=in action=allow protocol=TCP localport=80

# 开放 8080 端口（可选）
netsh advfirewall firewall add rule name="Backend Port 8080" dir=in action=allow protocol=TCP localport=8080
```

## ✅ 验证部署

1. 访问前端：`http://服务器IP`
2. 测试 API：`http://服务器IP/api/company/list`

## 🔧 常见问题

### 502 Bad Gateway
- 检查后端服务是否运行
- 检查端口是否正确
- 查看 Nginx 错误日志

### 数据库连接失败
- 检查 MySQL 服务状态
- 验证用户名密码
- 确认数据库已创建

### 端口被占用
```bash
# 查看端口占用
netstat -ano | findstr :8080

# 结束进程
taskkill /PID 进程ID /F
```

## 📦 备份策略

### 数据库备份

```bash
mysqldump -u root -p finance_db > backup_$(date +%Y%m%d).sql
```

### 配置文件备份

定期备份 `application.yml` 和 `nginx.conf`

## 🔒 安全建议

1. 修改数据库默认密码
2. 配置 HTTPS（推荐）
3. 限制远程数据库访问
4. 启用防火墙
5. 定期更新系统补丁

---

更多详细信息请参考 README.md

